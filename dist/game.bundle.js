!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";i.d(e,"a",function(){return n});const n={get canvasWidth(){return kontra.canvas.width/this.scale},get canvasHeight(){return kontra.canvas.height/this.scale},scale:1.5}},,,,function(t,e,i){"use strict";var n;i.r(e),function(t){t.Red="Red",t.Blue="Blue",t.Green="Green"}(n||(n={}));var r=function(){function t(){this.savedPatterns=new Map,R.debug&&console.log("initializing offscreen canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=16,this.canvas.height=16,this.context=this.canvas.getContext("2d")}return t.instance=function(){return void 0==this.offscreenCanvas&&(this.offscreenCanvas=new t),this.offscreenCanvas},t.prototype.getPattern=function(){return this.context.fillStyle="white",this.context.fillRect(0,0,16,8),this.context.fillStyle="pink",this.context.fillRect(0,8,16,8),this.context.createPattern(this.canvas,"repeat")},t.prototype.getPatternBasedOnColor=function(t,e,i,n,r,a){if(void 0===n&&(n=16),void 0===r&&(r=16),void 0===a&&(a=2),this.savedPatterns.has(s(t,e,i,n,r)))return this.savedPatterns.get(s(t,e,i,n,r));this.canvas.width=n,this.canvas.height=r;for(var h=function(n){return M.hsla(t,e,i,n)},c=function(n){return M.hsla(t,e,i-5,n)},d=function(n){return M.hsla(t,e,i-10,n)},l=function(n){return M.hsla(t,e,i+10,n)},u=[h,h,h,h,h,c,c,c,l,d],f=[h,h,h,d,l,d,d,function(n){return M.hsla(t,e,i-20,n)},l,function(n){return M.hsla(t,e,i+20,n)}],x=0;x<this.canvas.width;x+=a)for(var p=0;p<this.canvas.height;p+=a){var y=o(x>=this.canvas.width/4&&x<=3*this.canvas.width/4&&p>=this.canvas.height/4&&p<=3*this.canvas.height/4?u:f);this.context.fillStyle=y,this.context.fillRect(x,p,a,a)}var g=this.context.createPattern(this.canvas,"repeat");return this.savedPatterns.set(s(t,e,i,n,r),g),g},t.prototype.getPatternWithTransparency=function(t,e,i,n){void 0===e&&(e=16),void 0===i&&(i=16),void 0===n&&(n=2);var r=function(t,e,i,n,r){return"t/"+s(t,e,i,n,r)}(t.h,t.s,t.l,e,i);if(this.savedPatterns.has(r))return this.savedPatterns.get(r);this.canvas.width=e,this.canvas.height=i;for(var o=function(e){return M.hsla(t.h,t.s,t.l,e)},a=0;a<this.canvas.width;a+=n)for(var h=0;h<=this.canvas.height;h+=n){var c=o(parseFloat(A(0,.5).toFixed(2)));this.context.fillStyle=c,this.context.fillRect(a,h,n,n)}this.context.rotate(O(30));var d=this.context.createPattern(this.canvas,"repeat");return this.savedPatterns.set(r,d),d},t}();function s(t,e,i,n,r){return t+"/"+e+"/"+i+"/"+n+"/"+r}function o(t){return t[Math.round(A(0,9))](1)}function a(){for(var t=L(2,4),e="",i=0;i<t;i++)e+=""+l();return e}var h=["a","e","i","o","u","ä","ö","å"],c=97,d=122;function l(){var t=L(1,3);return 1===t?u():2===t?""+f()+u():""+f()+u()+f()}function u(){return function(t){var e=L(0,t.length-1);return t[e]}(h)}function f(){for(var t="";!t;){var e=L(c,d),i=String.fromCharCode(e);h.includes(i)||(t=i)}return t}function x(t,e,i,n){var r=e.x,s=e.y,o=void 0===i?{}:i,a=o.velocity,h=void 0===a?{dx:0,dy:0}:a,c=h.dx,d=h.dy,l=o.ttl,u=void 0===l?1/0:l,f=o.color,x=void 0===f?{r:255,g:255,b:255}:f,p=x.r,y=x.g,g=x.b,v=o.cameraPosition,S=void 0===n?{}:n,b=S.style,m=void 0===b?"normal":b,P=S.weight,E=void 0===P?"normal":P,k=S.size,C=void 0===k?24:k,I=S.family,O=void 0===I?"monospace":I;return void 0===r&&(r=R.canvasWidth/2-t.length*C*.65/2),kontra.sprite({x:r,y:s,dx:c,dy:d,ttl:u,maxTTL:u,render:function(){var e=this.getAlpha();if(this.context.fillStyle=M.rgba(p,y,g,e),this.context.font=m+" "+E+" "+C+"px "+O,v){var i=w({x:this.x,y:this.y},v);this.context.fillText(t,i.x,i.y)}else this.context.fillText(t,r,s)},getAlpha:function(){var t=this.maxTTL/2;return this.ttl<1/0&&this.ttl<t?1-(t-this.ttl)/t:1}})}function p(t){var e=12*t.length/2;return x(t.toUpperCase(),{x:R.canvasWidth/2-e,y:R.canvasHeight/2+100},{ttl:120},{size:18,family:"monospace"})}var y,g=function(){return(g=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function v(t,e,i,s,o,h,c,d){var l=(void 0===h?{}:h).drawOuterRadius,u=void 0===l||l;void 0===c&&(c=function(){var t=Math.round(A(0,2));return[y.Red,y.Green,y.Blue][t]}()),void 0===d&&(d=a());var f=Math.round(A(64,i)),x=Math.round(A(64,i)),v=A(0,360),m=I.inCircleGivenAngle(t,e,v),P=A(0,.05);return kontra.sprite({type:"planet",origin:t,orbit:e,x:m.x,y:m.y,radius:i,outerRadius:i+.25*i,ttl:1/0,dt:0,angle:v,da:P,rotation:A(0,Math.PI),claimedBy:void 0,beingClaimed:!1,claimedPercentage:0,isClaimed:function(){return void 0!==this.claimedBy},increaseClaim:function(t,e){if(!this.beingClaimed){var i=p(t+" FACTION CLAIMING "+d);o.addSprite(i),this.beingClaimed=!0}if(this.claimedPercentage+=e,this.claimedPercentage>=100){this.claimedPercentage=100,this.beingClaimed=!1,this.claimedBy=t;i=p(t+" FACTION CLAIMED "+d);o.addSprite(i)}},beingCollected:!1,resources:R.Planet.Resources,update:function(){this.dt+=1/60,this.rotation+=.25,this.angle+=this.da;var t=I.inCircleGivenAngle(this.origin,e,this.angle);this.x=t.x,this.y=t.y},render:function(){if(!T(this,s)){var t=w(this,s);this.context.save();var e=w(this.origin,s);this.context.translate(e.x,e.y),this.context.strokeStyle="rgba(255,255,255,0.15",this.context.beginPath(),this.context.arc(0,0,this.orbit,0,2*Math.PI),this.context.stroke(),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(O(this.rotation)),this.context.fillStyle=b(f,x,c),this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.context.beginPath();var r=this.context.createRadialGradient(0,0,3*this.radius/4,0,0,this.radius);r.addColorStop(0,"rgba(0,0,0,0)"),r.addColorStop(1,"rgba(0,0,0,0.7)"),this.context.fillStyle=r,this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),u&&(this.context.beginPath(),this.context.strokeStyle="turquoise",this.context.setLineDash([3,7]),this.context.arc(0,0,this.outerRadius,0,2*Math.PI),this.context.stroke()),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y-i-45),this.context.fillStyle="rgba(255,255,255,0.8)",this.context.font="normal normal 14px monospace";var o=d.length/2*10;if(this.context.fillText(d.toUpperCase(),-o,0),this.context.restore(),this.beingClaimed){var a=2*i,h=this.claimedPercentage/100*a;this.context.save(),this.context.translate(t.x-i,t.y+i+35),this.context.fillStyle="white",this.context.fillRect(0,0,h,5),this.context.strokeStyle="white",this.context.strokeRect(0,0,2*i,5),this.context.restore()}if(void 0!==this.claimedBy){var l=i+.35*i;this.context.save(),this.context.translate(t.x,t.y),this.context.strokeStyle=n.Red.toLowerCase(),this.context.lineWidth=5,this.context.beginPath(),this.context.arc(0,0,l,0,2*Math.PI),this.context.stroke(),this.context.restore()}}},getCloudPattern:function(t){var e=S[t],n=g({},e);return n.l+=50,r.instance().getPatternWithTransparency(n,i,i,3)}})}!function(t){t[t.Red=0]="Red",t[t.Green=1]="Green",t[t.Blue=2]="Blue",t[t.Desert=3]="Desert",t[t.Barren=4]="Barren",t[t.Paradise=5]="Paradise",t[t.Sun=6]="Sun"}(y||(y={}));var S=[{h:0,s:70,l:45},{h:120,s:100,l:39},{h:195,s:100,l:50},{h:195,s:100,l:50},{h:195,s:100,l:50},{h:195,s:100,l:50},{h:60,s:100,l:50}];function b(t,e,i){var n=S[i];return r.instance().getPatternBasedOnColor(n.h,n.s,n.l,t,e,3)}var m,P,E=i(0),k=function(){return(k=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},C=k({},E.a,{mapBoundary:1e4,maxAsteroidClusterSize:10,initialNumberOfClusters:10,collidableTypes:["asteroid","bullet","ship","cell","planet","planet-sun"],debug:!1,verbose:!1,typesToLog:["asteroid","ship"],logTheseProperties:function(t){return{type:t.type,x:t.x,y:t.y,ttl:t.ttl}},onlyLogInProximityToShip:!0,renderCollisionArea:!0,debugRadar:!0,UI:{Bar:{Width:100,Height:5}},Ship:{Energy:500,Life:200,Shield:300,EnergyCost:{Thrust:1,Brake:1,Shoot:10,ShieldRecharge:1,Vision:1},Radar:{Size:100,Radius:45,Range:1e3},InitialPosition:{get x(){return C.canvasWidth/2},get y(){return C.canvasHeight/2}}},Cell:{OuterRadius:8,InnerRadius:2,TTL:240,Speed:.7,EnergyBoost:20,LifeBoost:10},Planet:{Resources:3e3},Factions:(m={},m[n.Red]={Name:"Harkonnen",PlanetName:"",Planet:y.Red,Objective:"War & Conquest",Description:"House Harkonnen...",Emblem:""},m[n.Blue]={Name:"Atreides",PlanetName:"",Planet:y.Paradise,Objective:"Freedom & Liberty",Description:"House Atreides...",Emblem:"blueemblem"},m[n.Green]={Name:"Corrino",Planet:y.Green,PlanetName:"",Objective:"Wealth & Power",Description:"House Corrino...",Emblem:""},m),Sector:{Size:1e4},Stars:{MaxNumber:500}}),R=C,M={get:function(t){var e=A(0,255),i=A(0,255),n=A(0,255);return this.rgba(e,i,n,t)},rgba:function(t,e,i,n){return"rgba("+t+","+e+","+i+","+n+")"},hsla:function(t,e,i,n){return void 0===n&&(n=1),"hsla("+t+","+e+"%,"+i+"%,"+n+")"}},I={areNear:function(t,e,i){return Math.abs(t.x-e.x)<i&&Math.abs(t.y-e.y)<i},inCircleGivenAngle:function(t,e,i){return{x:t.x+Math.cos(O(i))*e,y:t.y+Math.sin(O(i))*e}}};function O(t){return t*Math.PI/180}function w(t,e,i){void 0===i&&(i=0);var n=1-.2*i;return{x:t.x-(e.x*n-R.canvasWidth/2),y:t.y-(e.y*n-R.canvasHeight/2)}}function T(t,e){return Math.abs(t.x-e.x)>R.mapBoundary||Math.abs(t.y-e.y)>R.mapBoundary}function B(t,e){return t+Math.random()*e}function A(t,e){return Math.random()*(e-t)+t}function L(t,e){return Math.floor(A(t,e+1))}function W(t,e,i,n){return kontra.sprite({type:"asteroid",x:t.x,y:t.y,radius:i,sides:[],ttl:1/0,dx:e.dx,dy:e.dy,dt:0,render:function(){var t=this;if(!T(this,n)){var e=w(this,n);this.context.save(),this.context.translate(e.x+this.radius,e.y),this.context.rotate(Math.PI/2);this.context.beginPath(),this.context.moveTo(0,0);for(var i=0;i<4;i++){this.sides[i]||(this.sides[i]={length:t.radius*(1+A(-.2,.2)),angle:A(30,70)});var s=this.sides[i].length,o=this.sides[i].angle,a=Math.cos(O(o))*s,h=Math.sin(O(o))*s;this.context.lineTo(a,h),this.context.strokeStyle=M.hsla(37,55,57),this.context.stroke(),this.context.translate(a,h),this.context.rotate(O(o))}this.context.fillStyle=r.instance().getPatternBasedOnColor(37,55,57),this.context.fill(),this.context.restore(),R.debug&&R.renderCollisionArea&&(this.context.save(),this.context.strokeStyle="red",this.context.beginPath(),this.context.arc(e.x,e.y,this.radius,0,2*Math.PI),this.context.stroke(),this.context.restore())}}})}function z(t,e,i){var n=A(0,360),r=A(0,i.magnitude||5),s=Math.cos(O(n))*r,o=Math.sin(O(n))*r;return kontra.sprite({type:"particle",x:t.x,y:t.y,dx:s,dy:o,ttl:A(0,i.ttl||30),dt:0,width:2,height:2,color:i.color||{r:255,g:255,b:255},update:function(){this.dt+=1/60,this.advance()},render:function(){var t=w(this,e),i=1-60*this.dt/30;this.context.fillStyle=M.rgba(this.color.r,this.color.g,this.color.b,i),this.context.fillRect(t.x,t.y,this.width,this.height)}})}function j(t,e,i){var n=A(0,360),r=Math.cos(O(n)),s=Math.sin(O(n));return kontra.sprite({type:"cell",cellType:i,x:t.x,y:t.y,dx:r*R.Cell.Speed,dy:s*R.Cell.Speed,ttl:R.Cell.TTL,render:function(){if(!T(this,e)){var t=w(this,e),n=1-(R.Cell.TTL-this.ttl)/R.Cell.TTL,r=function(t,e){return t===P.Energy?M.rgba(0,255,0,e):t===P.Life?M.rgba(255,0,0,e):"yellow"}(i,n);this.context.save(),this.context.strokeStyle=r,this.context.fillStyle=r,this.context.beginPath(),this.context.arc(t.x,t.y,R.Cell.InnerRadius,0,2*Math.PI),this.context.stroke(),this.context.fill(),this.context.beginPath(),this.context.arc(t.x,t.y,R.Cell.OuterRadius,0,2*Math.PI),this.context.stroke(),this.context.restore()}}})}!function(t){t.Energy="Energy",t.Life="Life"}(P||(P={}));var N=function(){function t(t){this.scene=t,this.dt=0}return t.prototype.processCollisions=function(t){this.dt+=t,this.initializeShip();for(var e=this.scene.sprites.foreground.filter(function(t){return R.collidableTypes.includes(t.type)}).sort(function(t,e){return t.type>e.type?1:-1}),i=0;i<e.length;i++){if("asteroid"===e[i].type)for(var n=i+1;n<e.length;n++)if("asteroid"!==e[n].type){var r=e[i],s=e[n];if(this.handleCollisionWithAsteroid(r,s))break}if("cell"===e[i].type&&this.ship){var o=e[i];this.handleCollisionBetweenCellAndShip(o,this.ship)}if("planet"===e[i].type&&this.ship){var a=e[i];this.handleCollisionBetweenPlanetAndShip(a,this.ship)}if("planet-sun"===e[i].type&&this.ship){var h=e[i];this.handleCollisionBetweenSunAndShip(h,this.ship)}}},t.prototype.initializeShip=function(){if(!this.ship){var t=this.scene.sprites.foreground.filter(function(t){return"ship"===t.type});t.length>0&&(this.ship=t[0])}},t.prototype.handleCollisionWithAsteroid=function(t,e){var i=t.x-e.x,n=t.y-e.y;if(Math.sqrt(i*i+n*n)<t.radius+e.width){if(!["ship","bullet"].includes(e.type))return;return t.ttl=0,"ship"===e.type?this.handleCollisionAsteroidWithShip(t,e):"bullet"===e.type&&(e.ttl=0),this.addExplosion(this.scene,t),t.radius>10&&function(t,e){R.debug&&console.log("Asteroid destroyed. Creating smaller asteroids",t);for(var i=0;i<3;i++){var n=W(t,{dx:A(-2,2),dy:A(-2,2)},t.radius/2.5,e.cameraPosition);e.addSprite(n),R.debug&&console.log("New Asteroid",n)}}(t,this.scene),this.releaseCells(this.scene,t),!0}return!1},t.prototype.handleCollisionAsteroidWithShip=function(t,e){R.debug&&console.log("Asteroid collided with ship",t,e);var i=4*t.radius;e.takeDamage(i)},t.prototype.addExplosion=function(t,e){for(var i=[{r:255,g:0,b:0},{r:255,g:165,b:0},{r:255,g:255,b:0}],n=0;n<10*e.radius;n++){var r=Math.round(2*Math.random()),s=z(e,t.cameraPosition,{ttl:50,color:i[r],magnitude:e.radius/2});t.addSprite(s)}},t.prototype.releaseCells=function(t,e){for(var i=Math.round(A(1,3)),n=0;n<i;n++){var r=j(e,t.cameraPosition,P.Energy);t.addSprite(r)}var s=Math.round(A(0,1));for(n=0;n<s;n++){r=j(e,t.cameraPosition,P.Life);t.addSprite(r)}},t.prototype.handleCollisionBetweenCellAndShip=function(t,e){var i=t.x-this.ship.x,n=t.y-this.ship.y;if(Math.sqrt(i*i+n*n)<R.Cell.OuterRadius+this.ship.collisionWidth)if(t.ttl=0,t.cellType===P.Energy){var r=Math.ceil(A(0,R.Cell.EnergyBoost));this.ship.energy.recharge(r),this.addBoostText(r,t,e,{r:0,g:255,b:0})}else if(t.cellType===P.Life){var s=Math.ceil(A(0,R.Cell.LifeBoost));this.ship.life.repair(s),this.addBoostText(s,t,e,{r:255,g:0,b:0})}},t.prototype.addBoostText=function(t,e,i,n){var r=x("+"+t,e,{velocity:{dx:0,dy:-1},ttl:120,color:n,cameraPosition:i},{size:12,family:"monospace"});this.scene.addSprite(r),R.debug&&console.log("Created cell text:",r)},t.prototype.handleCollisionBetweenPlanetAndShip=function(t,e){H(e,t,t.outerRadius)&&(t.claimedBy===e.faction?this.dt>.4&&(this.dt=0,this.provideBoosts(e)):t.increaseClaim(e.faction,.5))},t.prototype.handleCollisionBetweenSunAndShip=function(t,e){H(e,t,t.damageOuterRadius)?this.dt>.4&&(this.dt=0,e.takeDamage(100)):H(e,t,t.energyOuterRadius)&&this.dt>.4&&(this.dt=0,this.provideEnergyBoost(e,3))},t.prototype.provideBoosts=function(t){var e=[P.Energy,P.Life][Math.round(Math.random())];e===P.Energy?this.provideEnergyBoost(t):e===P.Life&&this.provideLifeBoost(t)},t.prototype.provideEnergyBoost=function(t,e){void 0===e&&(e=1);var i=Math.ceil(A(0,R.Cell.EnergyBoost*e));t.energy.recharge(i),this.addBoostText(i,t,t,{r:0,g:255,b:0})},t.prototype.provideLifeBoost=function(t){var e=Math.ceil(A(0,R.Cell.LifeBoost));t.life.repair(e),this.addBoostText(e,t,t,{r:255,g:0,b:0})},t}();function H(t,e,i){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)<i+2*t.collisionWidth}function F(t){return void 0===t&&(t={x:R.canvasWidth/2,y:R.canvasHeight/2}),{get x(){return this.position.x},set x(t){this.position.x=t},get y(){return this.position.y},set y(t){this.position.y=t},position:t}}function G(t){var e=void 0===t?{}:t,i=e.camera,n=void 0===i?F():i,r=e.update,s=void 0===r?function(){}:r,o=e.render,a=void 0===o?function(){}:o,h=kontra.gameLoop({update:function(t){s.bind(this)(t),this.sprites.background.forEach(function(t){return t.update()}),this.sprites.foreground.forEach(function(t){return t.update()}),this.collisionEngine.processCollisions(t),R.debug&&R.verbose&&this.logGameObjects(),this.sprites.foreground=this.sprites.foreground.filter(function(t){return t.isAlive()})},render:function(){a.bind(this)(),this.sprites.background.filter(function(t){return!T(t,n)}).forEach(function(t){return t.render()}),this.sprites.foreground.filter(function(t){return!T(t,n)}).forEach(function(t){return t.render()})}}),c=Object.assign(h,{sprites:{foreground:[],background:[]},addSprite:function(t,e){var i=(void 0===e?{}:e).isInForeground;void 0===i||i?this.sprites.foreground.push(t):this.sprites.background.push(t)},cameraPosition:n,logGameObjects:D});return c.collisionEngine=new N(c),c}function D(){var t=this;this.dt+=1/60,this.dt>=1&&(this.dt=0,console.table(this.sprites.filter(function(e){var i=R.typesToLog.includes(e.type);return R.onlyLogInProximityToShip&&(i=i&&I.areNear(e,t.cameraPosition,50)),i}).map(R.logTheseProperties)))}var U={getMagnitude:function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}};function q(t,e,i){return{isEnabled:!0,disable:function(){this.isEnabled=!1,this.dt=0},onEnergyChanged:function(n){if(n>i&&!this.isEnabled){this.isEnabled=!0;var r=p("- "+e.toUpperCase()+" ONLINE -");t.addSprite(r)}else if(n<i&&this.isEnabled){this.disable();r=p("- "+e.toUpperCase()+" OFFLINE -");t.addSprite(r)}}}}var _=function(){return(_=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function V(t,e){var i=kontra.sprite(_({},q(t,"RADAR",4*e.maxEnergy/5),{x:R.canvasWidth-R.Ship.Radar.Size/2,y:R.Ship.Radar.Size/2,dt:0,targetsInRadar:[],update:function(){var e=this;this.isEnabled&&(this.dt+=1/60,this.dt>1&&(this.dt=0,this.targetsInRadar=t.sprites.foreground.filter(function(i){return e.isInRange(i,t.cameraPosition)}).filter(function(t){return t.radius>15||t.size>10||t.width>10}).map(function(e){return function(t,e){var i={x:t.x-e.x,y:t.y-e.y},n={x:i.x/R.Ship.Radar.Range,y:i.y/R.Ship.Radar.Range};return{x:n.x*R.Ship.Radar.Radius,y:n.y*R.Ship.Radar.Radius,color:function(t){if("planet"===t)return M.rgba(0,255,0,.7);return"asteroid"===t?M.rgba(200,200,200,.7):M.rgba(150,150,150,.7)}(t.type),size:function(t){var e=t.radius||t.size||t.width;return Math.ceil(e/100*6)}(t)}}(e,t.cameraPosition)}),R.debug&&R.debugRadar&&console.log("Targets in radar: ",this.targetsInRadar)))},render:function(){var t=this;this.context.save(),this.context.translate(this.x,this.y);for(var e=R.Ship.Radar.Radius;e>15;e-=5)this.context.beginPath(),this.context.strokeStyle=M.rgba(255,255,255,.5),this.context.arc(0,0,e,0,2*Math.PI),this.context.stroke();this.context.closePath(),this.context.translate(-R.Ship.Radar.Size/2,0),this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(R.Ship.Radar.Size,0),this.context.stroke(),this.context.closePath(),this.context.translate(R.Ship.Radar.Size/2,-R.Ship.Radar.Size/2),this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(0,R.Ship.Radar.Size),this.context.stroke(),this.context.closePath(),this.isEnabled&&(this.context.translate(0,R.Ship.Radar.Size/2),this.targetsInRadar.forEach(function(e){t.context.fillStyle=e.color,t.context.beginPath(),t.context.arc(e.x,e.y,e.size/2,0,2*Math.PI),t.context.fill()})),this.context.restore()},isInRange:function(t,e){var i={x:t.x-e.x,y:t.y-e.y};return U.getMagnitude(i.x,i.y)<R.Ship.Radar.Range}}));return e.subscribe(i),i}var J=function(){return(J=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var K=100,Y=5;function Q(t,e,i,n,r,s){return kontra.sprite({type:"bullet",x:t.x+12*i,y:t.y+12*n,dx:e.dx+5*i,dy:e.dy+5*n,ttl:50,width:2,height:2,color:"white",update:function(){this.advance();var t=function(t,e,i,n,r){var s=void 0===r?{}:r,o=s.ttl,a=void 0===o?30:o,h=s.color,c=void 0===h?{r:255,g:255,b:255}:h,d=(s.magnitude,A(.5,1.5)),l=A(.5,1.5),u=A(-15,15),f=Math.cos(O(n+u)),x=Math.sin(O(n+u));return kontra.sprite({type:"particle",x:t.x,y:t.y,dx:e.dx*f*d,dy:e.dy*x*l,ttl:A(0,a),dt:0,width:2,height:2,update:function(){this.dt+=1/60,this.advance()},render:function(){var t=w(this,i),e=1-60*this.dt/a;this.context.fillStyle=M.rgba(c.r,c.g,c.b,e),this.context.fillRect(t.x,t.y,this.width,this.height)}})}({x:this.x,y:this.y},{dx:1,dy:1},r,0);s.addSprite(t)},render:function(){var t=w(this,r);this.context.fillStyle=this.color,this.context.fillRect(t.x,t.y,this.width,this.height)}})}var X=function(){return(X=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};var Z=function(){return(Z=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function $(t){var e=R.Ship.InitialPosition.x,i=R.Ship.InitialPosition.y,r=function(t,e){return kontra.sprite({maxEnergy:t,energy:t,systems:[],subscribe:function(t){this.systems.push(t)},x:5,y:5,dt:0,update:function(){if(this.dt+=1/60,this.dt>.25){var t=5-this.systems.filter(function(t){return t.isEnabled}).length;this.recharge(t),this.dt=0}},render:function(){var t=Math.ceil(this.energy*R.UI.Bar.Width/this.maxEnergy);this.context.fillStyle="green",this.context.fillRect(this.x,this.y,t,R.UI.Bar.Height),this.context.strokeStyle="white",this.context.strokeRect(this.x,this.y,R.UI.Bar.Width,R.UI.Bar.Height)},consume:function(t){var e=this;this.energy>0&&(this.energy-=t),this.systems.forEach(function(t){return t.onEnergyChanged(e.energy)})},recharge:function(t){var e=this;this.energy<this.maxEnergy&&(this.energy+=t),this.energy>this.maxEnergy&&(this.energy=this.maxEnergy),this.systems.forEach(function(t){return t.onEnergyChanged(e.energy)})},hasEnoughEnergy:function(t){return this.energy>=t},addOfflineText:function(t){var i=p(t);e.addSprite(i)}})}(R.Ship.Energy,t),s=function(t){return kontra.sprite({maxLife:t,life:t,x:5,y:15,dt:0,update:function(){this.dt+=1/60,this.dt>1&&(this.dt=0,this.repair(1))},repair:function(t){this.life<this.maxLife&&(this.life+=t),this.life>this.maxLife&&(this.life=this.maxLife)},render:function(){var t=Math.ceil(this.life*K/this.maxLife);this.context.fillStyle="red",this.context.fillRect(this.x,this.y,t,Y),this.context.strokeStyle="white",this.context.strokeRect(this.x,this.y,K,Y)},damage:function(t){this.life>0&&(this.life-=t),this.life<0&&(this.life=0),R.debug&&console.log("Ship took damage "+t+". Remaining life is "+this.life)},get:function(){return this.life}})}(R.Ship.Life),o=function(t,e,i,n,r){var s=kontra.sprite(J({},q(r,"SHIELD",3*e.maxEnergy/5),{maxShield:t,shield:t,x:5,y:25,shieldPosition:i,radius:n,dt:0,dtr:0,update:function(){this.dt+=1/60,this.dt>.25&&(this.isEnabled?this.shield<this.maxShield&&this.shield++:this.damage(3),this.dt=0)},render:function(){var t=Math.ceil(this.shield*R.UI.Bar.Width/this.maxShield);this.context.fillStyle="#00edff",this.context.fillRect(this.x,this.y,t,R.UI.Bar.Height),this.context.strokeStyle="white",this.context.strokeRect(this.x,this.y,R.UI.Bar.Width,R.UI.Bar.Height),0!==this.shield&&(this.dtr+=1/60,!this.isEnabled&&this.dtr>.5&&this.dtr<.75||(!this.isEnabled&&this.dtr>.75?this.dtr=0:(this.context.save(),this.context.strokeStyle="#00edff",this.context.fillStyle="rgba(0, 237, 255, 0.2)",this.context.beginPath(),this.context.arc(this.shieldPosition.x+A(-.5,.5),this.shieldPosition.y+A(-.5,.5),1.1*this.radius,0,2*Math.PI),this.context.stroke(),this.context.fill(),this.context.restore())))},damage:function(t){this.shield>0&&(this.shield-=t),this.shield<0&&(this.shield=0),R.debug&&(this.isEnabled?console.log("Ship took shield damage "+t+". Remaining shield is "+this.shield):console.log("Ship shield losing power "+t+". Remaining shield is "+this.shield))},get:function(){return this.shield},disable:function(){R.debug&&console.log("shield offline!!"),this.isEnabled=!1}}));return e.subscribe(s),s}(R.Ship.Shield,r,{x:e,y:i},20,t),a=kontra.sprite({x:R.canvasWidth-70,y:R.canvasHeight-10,speed:0,updateSpeed:function(t,e){var i=U.getMagnitude(t,e);this.speed=i},render:function(){var t=(100*this.speed).toFixed(0)+" km/s";this.context.fillStyle="white",this.context.font="normal normal 12px monospace",this.context.fillText(t,this.x,this.y)}}),h=V(t,r),c=function(t,e){var i=kontra.sprite(X({},q(t,"WEAPONS",2*e.maxEnergy/5),{dt:0,rotation:0,position:{x:0,y:0},velocity:{dx:0,dy:0},updateShipInformation:function(t,e,i){this.position=t,this.velocity=e,this.rotation=i},update:function(){if(this.isEnabled&&(this.dt+=1/60,kontra.keys.pressed("space")&&this.dt>.25&&e.hasEnoughEnergy(R.Ship.EnergyCost.Shoot))){this.dt=0;var i=Math.cos(O(this.rotation)),n=Math.sin(O(this.rotation)),r=Q(this.position,this.velocity,i,n,t.cameraPosition,t);t.addSprite(r)}}}));return e.subscribe(i),i}(t,r),d=function(t,e){var i=kontra.sprite(Z({},q(t,"NEAR SPACE RADAR",1*e.maxEnergy/5),{dt:0,render:function(){if(!this.isEnabled){this.context.save(),this.context.translate(R.canvasWidth/2,R.canvasHeight/2),this.context.beginPath();var t=this.context.createRadialGradient(0,0,Math.min(R.canvasWidth,R.canvasHeight)/8,0,0,3*Math.max(R.canvasWidth,R.canvasHeight)/4);t.addColorStop(0,"rgba(0,0,0,0.2)"),t.addColorStop(1,"rgba(0,0,0,1)"),this.context.fillStyle=t,this.context.arc(0,0,Math.max(R.canvasWidth,R.canvasHeight),0,2*Math.PI),this.context.fill(),this.context.restore()}}}));return e.subscribe(i),i}(t,r),l=kontra.sprite({type:"ship",faction:n.Red,parts:[r,s,o,a,h,c,d],image:kontra.assets.images.redshipsmall,x:e,y:i,rotation:0,collisionWidth:20,energy:r,life:s,shield:o,speed:a,radar:h,weapons:c,vision:d,dt:0,ttl:1/0,takeDamage:function(t){this.shield.get()>0?(this.shield.damage(t),this.shield.get()<=0&&this.life.damage(t/4)):this.life.damage(t),this.life.get()<=0&&(R.debug&&console.log("SHIP DIED"),this.ttl=0)},render:function(){this.context.save(),this.context.translate(e,i),this.context.rotate(O(this.rotation)),this.context.drawImage(this.image,-16,-16),R.debug&&R.renderCollisionArea&&(this.context.strokeStyle="red",this.context.beginPath(),this.context.arc(0,0,this.collisionWidth,0,2*Math.PI),this.context.stroke(),console.log(this.width)),this.context.restore(),this.parts.forEach(function(t){return t.render()})},update:function(){if(this.weapons.updateShipInformation(this,this,this.rotation),this.speed.updateSpeed(this.dx,this.dy),this.parts.forEach(function(t){return t.update()}),kontra.keys.pressed("left")){this.rotation+=-3;var e=this.createShipParticle(l.rotation+75,{x:5,y:-10});t.addSprite(e)}else if(kontra.keys.pressed("right")){this.rotation+=3;e=this.createShipParticle(l.rotation-75,{x:5,y:10});t.addSprite(e)}var i=Math.cos(O(this.rotation)),n=Math.sin(O(this.rotation));if(kontra.keys.pressed("up")&&this.energy.hasEnoughEnergy(R.Ship.EnergyCost.Thrust)){this.ddx=.1*i,this.ddy=.1*n,this.energy.consume(R.Ship.EnergyCost.Thrust);for(var r=0;r<2;r++){e=this.createShipParticle(l.rotation+180,{x:20,y:0});t.addSprite(e)}}else if(kontra.keys.pressed("down")&&this.energy.hasEnoughEnergy(R.Ship.EnergyCost.Brake)){this.ddx=-.1*i/2,this.ddy=-.1*n/2,this.energy.consume(R.Ship.EnergyCost.Brake);var s=this.createShipParticle(l.rotation+75,{x:5,y:-10}),o=this.createShipParticle(l.rotation-75,{x:5,y:10});t.addSprite(s),t.addSprite(o)}else this.ddx=this.ddy=0;this.advance(),Math.sqrt(this.dx*this.dx+this.dy*this.dy)>10&&(this.dx*=.95,this.dy*=.95)},createShipParticle:function(t,n){return void 0===n&&(n={x:0,y:0}),function(t,e,i,n){void 0===n&&(n={x:4,y:0});var r=A(.5,1.5),s=A(.5,1.5),o=A(-20,20),a=Math.cos(O(i+o)),h=Math.sin(O(i+o));return kontra.sprite({type:"particle",x:t.x,y:t.y,dx:e.dx*a*r,dy:e.dy*h*s,ttl:A(0,50),dt:0,width:2,height:2,thicknessVariance:A(-4,4),update:function(){this.dt+=1/60,this.advance()},render:function(){var t=1-60*this.dt/50;this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(O(i)),this.context.fillStyle=M.rgba(255,255,255,t),this.context.fillRect(n.x,n.y+this.thicknessVariance,this.width,this.height),this.context.restore()}})}({x:e,y:i},{dx:1,dy:1},t,n)}});return l}var tt=function(){return(tt=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function et(t,e,i,n){void 0===n&&(n=a());var r=function(t,e){var i={x:t.x+R.Sector.Size/2,y:t.y+R.Sector.Size/2},n=A(125,175);return function(t,e,i,n){void 0===n&&(n=a());var r=Math.round(A(64,e)),s=Math.round(A(64,e));return kontra.sprite({type:"planet-sun",x:t.x,y:t.y,radius:e,damageOuterRadius:e+.25*e,energyOuterRadius:3*e,ttl:1/0,dt:0,rotation:0,update:function(){this.rotation+=.1},render:function(){var t=w(this,i);this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(O(this.rotation)),this.context.fillStyle=b(r,s,y.Sun),this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.context.beginPath();var o=this.context.createRadialGradient(0,0,3*this.radius/4,0,0,this.radius);o.addColorStop(0,"rgba(0,0,0,0)"),o.addColorStop(1,"rgba(0,0,0,0.7)"),this.context.fillStyle=o,this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.strokeStyle="red",this.context.setLineDash([2,2]),this.context.arc(0,0,this.damageOuterRadius,0,2*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="yellow",this.context.setLineDash([3,7]),this.context.arc(0,0,this.energyOuterRadius,0,2*Math.PI),this.context.stroke(),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y-e-45),this.context.fillStyle="rgba(255,255,255,0.8)",this.context.font="normal normal 14px monospace";var a=n.length/2*10;this.context.fillText(n.toUpperCase(),-a,0),this.context.restore()}})}(tt({},i),n,e)}(e,i),s=function(t,e,i){for(var n=L(1,5),r=[],s={x:t.x,y:t.y},o=0;o<n;o++){var a=A(500,1e3);s.x=s.x+a;var h=A(50,100),c=v(t,s.x,h,i,e);r.push(c)}return r}(r,t,i);return{x:e.x,y:e.y,name:n,sun:r,planets:s,bodies:[r].concat(s)}}function it(t){var e=t.x,i=t.y,n=t.cameraPosition,r=A(0,1).toFixed(2),s=1-3*parseFloat(r)/4,o=M.get(s),a=1-parseFloat(r)+2;return kontra.sprite({x:B(e,e/2),y:B(i,i/2),type:"star",dx:0,dy:0,ttl:1/0,distance:r,color:o,size:a,update:function(){},render:function(){if(!T(this,n)){var t=w(this,n,this.distance);this.context.fillStyle=this.color,this.context.fillRect(t.x,t.y,this.size,this.size)}}})}function nt(t){var e=R.Ship.InitialPosition.x-R.canvasWidth/2-500,i=R.Ship.InitialPosition.x+R.canvasWidth/2+500,n=R.canvasWidth/2+500,r=R.canvasWidth+1e3,s=function(t){for(var e=t.start,i=t.end,n=t.spaceBetweenStars,r=t.cameraPosition,s=[],o=e;o<=i;o+=n)for(var a=e;a<=i;a+=n){var h=it({x:o,y:a,cameraPosition:r});s.push(h)}return s}({start:e,end:i,spaceBetweenStars:50,cameraPosition:t});return kontra.sprite({x:e,y:e,stars:s,dt:0,ttl:1/0,update:function(){(this.dt+=1/60,this.dt>.25)&&(this.stars.filter(function(e){return t.x-e.x>n}).forEach(function(t){return t.x=t.x+r}),this.stars.filter(function(e){return Math.abs(t.x-e.x)>n}).forEach(function(t){return t.x=t.x-r}),this.stars.filter(function(e){return t.y-e.y>n}).forEach(function(t){return t.y=t.y+r}),this.stars.filter(function(e){return Math.abs(t.y-e.y)>n}).forEach(function(t){return t.y=t.y-r}))},render:function(){this.stars.forEach(function(t){return t.render()})}})}function rt(){var t=F(),e=G({camera:t,update:function(t){i.isAlive()||ht.instance().goToGameOverScene();!function(t){t.sprites.foreground.forEach(function(e){T(e,t.cameraPosition)&&(e.ttl=0,R.debug&&console.log("Object "+e.type+" out of bounds",e))})}(e)}}),i=$(e);return t.position=i,function(t,e){var i=nt(e);t.addSprite(i,{isInForeground:!1})}(e,i),function(t,e){et(t,{x:-R.Sector.Size/2,y:-R.Sector.Size/2},e).bodies.forEach(function(e){return t.addSprite(e)})}(e,i),function(t,e){for(var i=0;i<R.initialNumberOfClusters;i++){var n=Math.ceil(A(0,R.maxAsteroidClusterSize));st(t,e,n)}}(e,i),function(t,e){for(var i=0;i<R.initialNumberOfClusters;i++){var n=Math.ceil(A(0,R.maxAsteroidClusterSize));st(t,e,n,!0,500)}}(e,i),e.addSprite(i),e}function st(t,e,i,n,r){void 0===n&&(n=!1),void 0===r&&(r=100);var s=A(-1e3,1e3),o=A(-1e3,1e3),a=0,h=0;n||(a=A(-2,2),h=A(-2,2));for(var c=0;c<i;c++){var d=A(0,30),l=A(-r,r),u=A(-r,r),f=0;n||(f=A(-.25,.25));var x=W({x:s+l,y:o+u},{dx:a+f,dy:h+f},d,e);t.addSprite(x)}}function ot(){var t=G({update:function(){kontra.keys.pressed("enter")&&ht.instance().goToChooseFaction()}}),e=x("JS13K SPACE SHOOTER",{x:void 0,y:250},{},{size:48});t.addSprite(e);var i=x("Press ENTER to start",{x:void 0,y:300});return t.addSprite(i),t}function at(){var t=G({update:function(t){kontra.keys.pressed("enter")&&i.selectedFaction()&&ht.instance().goToSpaceScene(i.selectedFaction())}}),e=x("CHOOSE YOUR FACTION",{x:void 0,y:100},{},{size:48});t.addSprite(e);var i=function(t){var e=R.canvasWidth/4,i=e/2;return kontra.sprite({dt:0,ttl:1/0,selectedFaction:function(){if(void 0!==this.selectedIndex)return this.factions[this.selectedIndex]},selectedIndex:void 0,factions:[n.Blue,n.Green,n.Red],planets:[],emblems:[],update:function(t){this.dt+=1/60,this.dt>.5&&void 0===this.selectedIndex&&(this.dt=0,this.selectedIndex=0),this.dt>.5&&kontra.keys.pressed("left")?(this.dt=0,this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.factions.length-1)):this.dt>.5&&kontra.keys.pressed("right")&&(this.dt=0,this.selectedIndex++,this.selectedIndex>=this.factions.length&&(this.selectedIndex=0)),this.planets.forEach(function(e){return e.update(t)})},render:function(){var t=this;this.factions.forEach(function(e,i){return t.renderFaction(e,i)})},renderFaction:function(n,r){var s=R.Factions[n];if(this.context.font="normal normal 24px monospace",this.context.fillText(s.Name.toUpperCase(),r*e+i+(e/2-s.Name.length/2*.63*24),200),!this.planets[r]){var o={x:r*e+i+e/2,y:300};this.planets[r]=v(o,0,50,{x:R.canvasWidth/2,y:R.canvasHeight/2},t,{drawOuterRadius:!1},s.Planet,s.PlanetName)}this.planets[r].render(),this.context.font="normal normal 12px monospace",this.context.fillText(s.Objective.toUpperCase(),r*e+i+e/2-s.Objective.length/2*12*.63,400),n===this.selectedFaction()&&(this.context.strokeStyle="white",this.context.strokeRect(r*e+i,150,e,300))}})}(t);return t.addSprite(i),t}var ht=function(){function t(){this.currentScene=ot()}return t.instance=function(){return void 0==this.game&&(this.game=new t),this.game},t.prototype.start=function(){this.currentScene.start()},t.prototype.goToSpaceScene=function(t){this.switchToScene(rt())},t.prototype.goToGameOverScene=function(){this.switchToScene(function(){var t=G({update:function(){kontra.keys.pressed("enter")&&ht.instance().goToOpenScene()}}),e=x("GAME OVER",{x:100,y:250},void 0,{size:48});t.addSprite(e);var i=x("Press ENTER to play again",{x:200,y:300});return t.addSprite(i),t}())},t.prototype.goToChooseFaction=function(){this.switchToScene(at())},t.prototype.goToOpenScene=function(){this.switchToScene(ot())},t.prototype.switchToScene=function(t){this.currentScene.stop(),this.currentScene=t,this.start()},t}();ht.instance().start()}]);