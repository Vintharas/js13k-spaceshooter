!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){t.exports=i.p+"blueship.png"},function(t,e){kontra={init(t){var e=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");this.context=e.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(t){let e,i,s,n,a=(t=t||{}).fps||60,r=0,o=1e3/a,h=1/a,l=!1===t.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function d(){if(i=requestAnimationFrame(d),s=performance.now(),n=s-e,e=s,!(n>1e3)){for(kontra._tick(),r+=n;r>=o;)c.update(h),r-=o;l(),c.render()}}let c={update:t.update,render:t.render,isStopped:!0,start(){e=performance.now(),this.isStopped=!1,requestAnimationFrame(d)},stop(){this.isStopped=!0,cancelAnimationFrame(i)}};return c},function(){let t={},e={},s={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let t=0;t<26;t++)s[65+t]=(10+t).toString(36);for(i=0;i<10;i++)s[48+i]=""+i;addEventListener("keydown",function(i){let n=s[i.which];e[n]=!0,t[n]&&t[n](i)}),addEventListener("keyup",function(t){e[s[t.which]]=!1}),addEventListener("blur",function(t){e={}}),kontra.keys={bind(e,i){[].concat(e).map(function(e){t[e]=i})},unbind(e,i){[].concat(e).map(function(e){t[e]=i})},pressed:t=>!!e[t]}}(),function(){class t{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){this.x+=(t.x||0)*(e||1),this.y+=(t.y||0)*(e||1)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}kontra.vector=((e,i)=>new t(e,i)),kontra.vector.prototype=t.prototype;class e{init(t,e,i,s){for(e in t=t||{},this.position=kontra.vector(t.x,t.y),this.velocity=kontra.vector(t.dx,t.dy),this.acceleration=kontra.vector(t.ddx,t.ddy),this.width=this.height=0,this.context=kontra.context,t)this[e]=t[e];if(i=t.image)this.image=i,this.width=i.width,this.height=i.height;else if(i=t.animations){for(e in i)this.animations[e]=i[e].clone(),s=s||i[e];this._ca=s,this.width=s.width,this.height=s.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this._ca=this.animations[t],this._ca.loop||this._ca.reset()}advance(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--,this._ca&&this._ca.update(t)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(t=>(new e).init(t)),kontra.sprite.prototype=e.prototype}(),kontra.pool=function(t){let e=0;return{_c:(t=t||{}).create,objects:[t.create()],size:1,maxSize:t.maxSize||1/0,get(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let i=this.objects.shift();i.init(t),this.objects.push(i),e++},getAliveObjects(){return this.objects.slice(this.objects.length-e)},clear(){e=this.objects.length=0,this.size=1,this.objects.push(this._c())},update(t){let i,s=this.size-1,n=Math.max(this.objects.length-e,0);for(;s>=n;)(i=this.objects[s]).update(t),i.isAlive()?s--:(this.objects=this.objects.splice(s,1).concat(this.objects),e--,n++)},render(){let t=Math.max(this.objects.length-e,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}}},function(t,e,i){"use strict";i.r(e);i(1);let s={get canvasWidth(){return kontra.canvas&&kontra.canvas.width/this.scale},get canvasHeight(){return kontra.canvas&&kontra.canvas.height/this.scale},scale:1.5,collidableTypes:["Asteroid","Bullet","Ship","Cell","Planet","Sun","Elder"],mapBoundary:1e4,debug:!1,renderDebugData:!0,verbose:!1,typesToLog:["Asteroid","Ship","Elder","Bullet"],logTheseProperties:t=>({type:t.type,x:t.x,y:t.y,dx:0,dy:0,ttl:t.ttl}),onlyLogInProximityToShip:!0,renderCollisionArea:!1,debugRadar:!1,showPath:!1,debugSpawnObjects:!1,UI:{Bar:{Width:100,Height:5}},Asteroids:{MaxAsteroidClusterSize:5,InitialNumberOfClusters:5},Ship:{Energy:700,Life:300,Shield:400,EnergyCost:{Thrust:1,Brake:1,Shoot:10,ShieldRecharge:1,Vision:1},Radar:{Size:100,Radius:45,Range:1e3},InitialPosition:{get x(){return s.canvasWidth/2},get y(){return s.canvasHeight/2}}},Cell:{OuterRadius:8,InnerRadius:2,TTL:240,Speed:.7,EnergyBoost:20,LifeBoost:10},Planet:{Resources:3e3},Factions:{0:{Name:"Harkonnen",PlanetName:"",Planet:0,Objective:"War & Conquest",Description:"House Harkonnen...",get Ship(){return jt.instance().assets.images.redship},Color:{r:255,g:0,b:0},Modifiers:{Life:100,LifeRepairRate:1,Energy:100,EnergyRechargeRate:-1,Shield:100,ShieldRechargeRate:1,Rotation:-1.5,Speed:-.025,FireRate:-.1,Damage:5,Protection:5}},1:{Name:"Earth",Color:{r:0,g:227,b:255},PlanetName:"Earth",Planet:7,Objective:"Freedom & Liberty",Description:"Earth",get Ship(){return jt.instance().assets.images.blueship},Modifiers:{Life:-100,LifeRepairRate:1,Energy:100,EnergyRechargeRate:2,Shield:-100,ShieldRechargeRate:1,Rotation:2,Speed:.025,FireRate:0,Damage:-5,Protection:-5}},2:{Name:"Corrino",Planet:2,PlanetName:"",Color:{r:0,g:255,b:0},Objective:"Wealth & Power",Description:"House Corrino...",get Ship(){return jt.instance().assets.images.greenship},Modifiers:{Life:0,LifeRepairRate:0,Energy:0,EnergyRechargeRate:0,Shield:0,ShieldRechargeRate:0,Rotation:0,Speed:0,Damage:0,FireRate:0,Protection:0}}},Galaxy:{Size:1e5},Sector:{Size:1e4},Stars:{MaxNumber:500},Elders:{MaxNumber:1e3},Bullets:{NumberOfParticles:2},Textures:{Planet:100,Sun:100,Elder:20}};var n=s;let a={get(t){let e=u(0,255),i=u(0,255),s=u(0,255);return this.rgba(e,i,s,t)},rgb:t=>`rgb(${t.r},${t.g},${t.b})`,rgba:(t,e,i,s)=>`rgba(${t},${e},${i},${s})`,hsla:(t,e,i,s=1)=>`hsla(${t},${e}%,${i}%,${s})`},r={areNear:(t,e,i)=>Math.abs(t.x-e.x)<i&&Math.abs(t.y-e.y)<i,inCircleGivenAngle:(t,e,i)=>({x:t.x+Math.cos(o(i))*e,y:t.y+Math.sin(o(i))*e})};function o(t){return t*Math.PI/180}function h(t,e,i=0){let s=1-.2*i;return{x:t.x-(e.x*s-n.canvasWidth/2),y:t.y-(e.y*s-n.canvasHeight/2)}}let l=2e3;function d(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i>n.canvasWidth||s>n.canvasHeight}function c(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i>1e4||s>1e4}function p(t,e){return t+Math.random()*e}function u(t,e){return Math.random()*(e-t)+t}function y(t,e){return Math.floor(u(t,e+1))}function g(t){return t[y(0,t.length-1)]}class x{constructor(){this.savedPatterns=new Map,this.canvas=document.createElement("canvas"),this.canvas.width=16,this.canvas.height=16,this.context=this.canvas.getContext("2d")}static instance(){return void 0==this.offscreenCanvas&&(this.offscreenCanvas=new x),this.offscreenCanvas}getPatternBasedOnColors(t,e,i=16,s=16,n=2){if(this.savedPatterns.has(m(t,e,i,s)))return this.savedPatterns.get(m(t,e,i,s));this.canvas.width=i,this.canvas.height=s;let r=t,o=e,h=t=>a.hsla(r.h,r.s,r.l,t),l=t=>a.hsla(r.h,r.s,r.l+10,t),d=t=>a.hsla(r.h,r.s,r.l-10,t),c=t=>a.hsla(o.h,o.s,o.l,t),p=[h,h,h,h,l,l,d,d,c,c];for(let t=0;t<this.canvas.width;t+=n)for(let e=0;e<this.canvas.height;e+=n){let i=b(p);this.context.fillStyle=i,this.context.fillRect(t,e,n,n)}let u=this.context.createPattern(this.canvas,"repeat");return this.savedPatterns.set(m(t,e,i,s),u),u}}function f(t,e,i,s,n){return`${t}/${e}/${i}/${s}/${n}`}function m(t,e,i,s){return`${f(t.h,t.s,t.l,i,s)}//${f(e.h,e.s,e.l,i,s)}`}function b(t){return t[Math.round(u(0,9))](1)}function v(t,e,i,s){return kontra.sprite({type:"Asteroid",x:t.x,y:t.y,radius:i,sides:[],ttl:1/0,dx:e.dx,dy:e.dy,dt:0,render(){if(d(this,s))return;let t=h(this,s);this.context.save(),this.context.translate(t.x+this.radius,t.y),this.context.rotate(Math.PI/2);let e=()=>this.radius*(1+u(-.2,.2));this.context.beginPath(),this.context.moveTo(0,0);for(let t=0;t<4;t++){this.sides[t]||(this.sides[t]={length:e(),angle:u(30,70)});let i=this.sides[t].length,s=this.sides[t].angle,n=Math.cos(o(s))*i,r=Math.sin(o(s))*i;this.context.lineTo(n,r),this.context.strokeStyle=a.hsla(37,55,57),this.context.stroke(),this.context.translate(n,r),this.context.rotate(o(s))}let i={h:37,s:55,l:57};this.context.fillStyle=x.instance().getPatternBasedOnColors(i,{h:i.h,s:i.s,l:i.l+10}),this.context.fill(),this.context.restore()}})}function S(t,e,i,s,{ttl:n=30,color:r={r:255,g:255,b:255}}={}){let l=u(-5,5),d=Math.cos(o(s+l)),c=Math.sin(o(s+l));return kontra.sprite({type:"Particle",x:t.x,y:t.y,dx:e.dx-4*d,dy:e.dy-4*c,ttl:u(20,n),dt:0,width:2,update(){this.dt+=1/60,this.advance()},render(){let t=h(this,i),e=60*this.dt,s=1-e/n,o=(1+.5*e/n)*this.width;this.context.fillStyle=a.rgba(r.r,r.g,r.b,s),this.context.fillRect(t.x,t.y,o,o)}})}function w(t,e,i){let s=u(0,360),n=u(0,i.magnitude||5),r=Math.cos(o(s))*n,l=Math.sin(o(s))*n;return kontra.sprite({type:"Particle",x:t.x,y:t.y,dx:r,dy:l,ttl:u(0,i.ttl||30),dt:0,width:2,height:2,color:i.color||{r:255,g:255,b:255},update(){this.dt+=1/60,this.advance()},render(){let t=h(this,e),i=1-60*this.dt/30;this.context.fillStyle=a.rgba(this.color.r,this.color.g,this.color.b,i),this.context.fillRect(t.x,t.y,this.width,this.height)}})}let P={drawCircle(t,e,i,s,n,a=1,r){t.strokeStyle=n,t.lineWidth=a,r&&t.setLineDash(r),t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.stroke()},fillCircle(t,e,i,s,n,a=1){t.fillStyle=n,t.lineWidth=a,t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill()},drawLine(t,e,i,s,n,a){t.beginPath(),a&&(t.strokeStyle=a),t.moveTo(e,i),t.lineTo(s,n),t.stroke()},fillText(t,e,i,s,n="rgba(255,255,255,0.8)",a="normal normal 14px monospace"){t.fillStyle=n,t.font=a,t.fillText(e,i,s)},fillRect(t,e,i,s,n,a){t.fillStyle=a,t.fillRect(e,i,s,n)},strokeRect(t,e,i,s,n,a){t.strokeStyle=a,t.strokeRect(e,i,s,n)}};function E(t,e,i){let s=u(0,360),n=Math.cos(o(s)),r=Math.sin(o(s));return kontra.sprite({type:"Cell",cellType:i,x:t.x,y:t.y,dx:.5*n,dy:.5*r,outerRadius:8,ttl:240,render(){if(d(this,e))return;let t=h(this,e),s=1-(240-this.ttl)/240,n=function(t,e){return 0===t?a.rgba(0,255,0,e):1===t?a.rgba(255,0,0,e):"yellow"}(i,s);this.context.save(),P.fillCircle(this.context,t.x,t.y,2,n),P.drawCircle(this.context,t.x,t.y,this.outerRadius,n),this.context.restore()}})}function T(t,e=0){return{text:t,type:e}}const k=[{},{style:"italic"},{color:{r:0,g:255,b:0}}];function C(t,{x:e,y:i},{velocity:{dx:s,dy:r}={dx:0,dy:0},ttl:o=1/0,color:{r:l,g:d,b:c}={r:255,g:255,b:255},cameraPosition:p}={},{style:u="normal",weight:y="normal",size:g=24,family:x="monospace"}={}){return void 0===e&&(e=n.canvasWidth/2-t.length*g*.65/2),kontra.sprite({type:"Text",x:e,y:i,dx:s,dy:r,ttl:o,maxTTL:o,render(){let s=this.getAlpha();if(this.context.fillStyle=a.rgba(l,d,c,s),this.context.font=`${u} ${y} ${g}px ${x}`,p){let e=h({x:this.x,y:this.y},p);this.context.fillText(t,e.x,e.y)}else this.context.fillText(t,e,i)},getAlpha(){let t=this.maxTTL/2;return this.ttl<1/0&&this.ttl<t?1-(t-this.ttl)/t:1}})}function M(t,e=0){let i=k[e],s=12*t.length/2;return C(t.toUpperCase(),{x:n.canvasWidth/2-s,y:n.canvasHeight/2+100},{ttl:120,color:i.color},{size:18,family:"monospace",style:i.style})}let R={getMagnitude:t=>Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),getDistance:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),getDistanceMagnitude:(t,e)=>R.getMagnitude(R.getDistance(t,e))},O=20,A=10;class B{constructor(t){this.scene=t,this.dt=0}processCollisions(t){this.dt+=t,this.initializeShip();let e=[...this.scene.sprites.foreground,...this.scene.sprites.activePoolObjects()].filter(t=>!function(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i>l||s>l}(t,this.scene.cameraPosition)).filter(t=>n.collidableTypes.includes(t.type)).sort((t,e)=>t.type>e.type?1:-1);for(let t=0;t<e.length;t++){if("Asteroid"===e[t].type)for(let i=t+1;i<e.length;i++)if("Asteroid"!==e[i].type){let s=e[t],n=e[i];if(this.handleCollisionWithAsteroid(s,n))break}if("Bullet"===e[t].type)for(let i=t+1;i<e.length;i++)if("Bullet"!==e[i].type&&"Asteroid"!==e[t].type){let s=e[t],n=e[i];if(this.handleCollisionWithBullet(s,n))break}if("Cell"===e[t].type&&this.ship){let i=e[t];this.handleCollisionBetweenCellAndShip(i,this.ship)}if("Planet"===e[t].type&&this.ship){let i=e[t];this.handleCollisionBetweenPlanetAndShip(i,this.ship)}if("Sun"===e[t].type&&this.ship){let i=e[t];this.handleCollisionBetweenSunAndShip(i,this.ship)}}}initializeShip(){if(this.ship)return;let t=this.scene.sprites.foreground.filter(t=>"Ship"===t.type);t.length>0&&([this.ship]=t)}handleCollisionWithAsteroid(t,e){if(R.getDistanceMagnitude(t,e)<t.radius+e.width){if(!["Ship","Bullet"].includes(e.type))return;return t.ttl=0,"Ship"===e.type?this.handleCollisionAsteroidWithShip(t,e):"Bullet"===e.type&&(e.ttl=0),this.addExplosion(this.scene,t),t.radius>10&&function(t,e){for(let i=0;i<3;i++){let i=v(t,{dx:u(-2,2),dy:u(-2,2)},t.radius/2.5,e.cameraPosition);e.addSprite(i)}}(t,this.scene),this.releaseCells(this.scene,t),!0}return!1}handleCollisionWithBullet(t,e){t.owner!==e&&(t.owner.faction&&t.owner.faction===e.faction||"Elder"===t.owner.type&&"Elder"===e.type||R.getDistanceMagnitude(t,e)<t.width+e.width/2&&(e.takeDamage&&e.takeDamage(t.damage),t.ttl=0,0===e.ttl&&this.addExplosion(this.scene,e)))}handleCollisionAsteroidWithShip(t,e){let i=4*t.radius;e.takeDamage(i),0===e.ttl&&this.addExplosion(this.scene,e)}addExplosion(t,e){let i=[{r:255,g:0,b:0},{r:255,g:165,b:0},{r:255,g:255,b:0}],s=e.radius||e.width||e.size,n=10*s;for(let a=0;a<n;a++){let n=Math.round(2*Math.random()),a=w(e,t.cameraPosition,{ttl:50,color:i[n],magnitude:s/2});t.addSprite(a)}}releaseCells(t,e){let i=Math.round(u(1,3));for(let s=0;s<i;s++){let i=E(e,t.cameraPosition,0);t.addSprite(i)}let s=Math.round(u(0,1));for(let i=0;i<s;i++){let i=E(e,t.cameraPosition,1);t.addSprite(i)}}handleCollisionBetweenCellAndShip(t,e){let i=t.x-this.ship.x,s=t.y-this.ship.y;if(Math.sqrt(i*i+s*s)<t.outerRadius+this.ship.collisionWidth)if(t.ttl=0,0===t.cellType){let i=Math.ceil(u(0,O));this.ship.energy.recharge(i),this.addBoostText(i,t,e,{r:0,g:255,b:0})}else if(1===t.cellType){let i=Math.ceil(u(0,A));this.ship.life.repair(i),this.addBoostText(i,t,e,{r:255,g:0,b:0})}}addBoostText(t,e,i,s){let n=C(`+${t}`,e,{velocity:{dx:0,dy:-1},ttl:120,color:s,cameraPosition:i},{size:12,family:"monospace"});this.scene.addSprite(n)}handleCollisionBetweenPlanetAndShip(t,e){if(D(e,t,t.outerRadius))if(t.claimedBy===e.faction){if(this.dt>.4){this.dt=0;let i=t.planetType===n.Factions[e.faction].Planet?2:1;this.provideBoosts(e,i)}}else if(t.increaseClaim(e.faction,.5),t.claimedBy===e.faction&&7===t.planetType){let e=jt.instance().story.play(this.scene,4);setTimeout(()=>{t.name="orion (new earth)"},1e3*e),setTimeout(()=>{jt.instance().goToGameOverScene({win:!0})},1e3*e+2e3)}}handleCollisionBetweenSunAndShip(t,e){D(e,t,t.damageOuterRadius)?this.dt>.4&&e.ttl>0&&(this.dt=0,e.takeDamage(100),0===e.ttl&&this.addExplosion(this.scene,e)):D(e,t,t.energyOuterRadius)&&this.dt>.4&&(this.dt=0,this.provideEnergyBoost(e,3))}provideBoosts(t,e=1){let i=[0,1][Math.round(Math.random())];0===i?this.provideEnergyBoost(t,e):1===i&&this.provideLifeBoost(t,e)}provideEnergyBoost(t,e=1){let i=Math.ceil(u(0,O*e));t.energy.recharge(i),this.addBoostText(i,t,t,{r:0,g:255,b:0})}provideLifeBoost(t,e=1){let i=Math.ceil(u(0,A*e));t.life.repair(i),this.addBoostText(i,t,t,{r:255,g:0,b:0})}}function D(t,e,i){let s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)<i+2*t.collisionWidth}function j(t={x:n.canvasWidth/2,y:n.canvasHeight/2}){return{get x(){return this.position.x},set x(t){this.position.x=t},get y(){return this.position.y},set y(t){this.position.y=t},position:t}}function $(){}function L(t,...e){return function(...i){t.apply(this,i),e.forEach(t=>t.apply(this,i))}}function I({action:t,t:e,condition:i=(()=>!0)}){let s=0;return function(){i.apply(this)&&(s+=1/60)>e&&(s=0,t.apply(this))}}class W{constructor(){this.background=[],this.foreground=[],this.shell=[],this.pools=[]}[Symbol.iterator](){return[...this.background,...this.foreground,...this.pools,...this.shell][Symbol.iterator]()}*allSprites(){yield*this.background,yield*this.foreground,yield*this.activePoolObjects(),yield*this.shell}activePoolObjects(){return this.pools.map(t=>t.getAliveObjects()).reduce((t,e)=>[...e,...t],[])}}function _({camera:t=j(),update:e=(()=>{}),render:i=(()=>{}),props:s={}}={}){let a=new W,r=kontra.gameLoop({update:L(e,function(t){Array.from(this.sprites).forEach(t=>t.update()),this.collisionEngine.processCollisions(t),n.debug&&n.verbose&&this.logGameObjects();this.sprites.foreground=this.sprites.foreground.filter(t=>t.isAlive()),this.sprites.shell=this.sprites.shell.filter(t=>t.isAlive())},I({condition(){return this.messageQueue.length>0},action(){let t=this.messageQueue.shift(),e=M(t.text,t.type);this.addSprite(e,{sceneLayer:2})},t:2})),render:L(i,function(){Array.from(this.sprites).forEach(t=>t.render())})}),o=Object.assign(r,Object.assign({messageQueue:[],sprites:a},s,{addSprite(t,{sceneLayer:e=1}={}){1===e?this.sprites.foreground.push(t):2===e?this.sprites.shell.push(t):this.sprites.background.push(t)},addPool(t){this.sprites.pools.push(t)},cameraPosition:t,logGameObjects:F,showMessage(...t){if(0===this.messageQueue.length&&!this.sprites.shell.find(t=>"Text"===t.type)){let e;[e,...t]=t;let i=M(e.text,e.type);this.addSprite(i,{sceneLayer:2})}t.forEach(t=>this.messageQueue.push(t))}}));return o.collisionEngine=new B(o),n.debug&&n.renderDebugData&&o.addSprite(function(t){return kontra.sprite({x:40,y:n.canvasHeight/2,lastframe:performance.now(),fps:0,dt:0,ttl:1/0,update(){this.dt+=1/60;let t=performance.now();this.dt>.5&&(this.dt=0,this.fps=1e3/(t-this.lastframe)),this.lastframe=t},render(){this.context.save(),this.context.font="normal normal 12px monospace",this.context.fillStyle="white";let e=`\nfps: ${this.fps.toFixed(0)}\ncamera : (${t.cameraPosition.x.toFixed(0)}, ${t.cameraPosition.y.toFixed(0)})\n${function(t){let e=t.reduce((t,e)=>(t.has(e.type)?t.set(e.type,t.get(e.type)+1):t.set(e.type,1),t),new Map);return Array.from(e.keys()).reduce((t,i)=>t+`${i}: ${e.get(i)}\n`,"")}(Array.from(t.sprites.allSprites()))}\n      `;e.split("\n").forEach((t,e)=>{this.context.fillText(t,this.x,this.y+10*e,500)}),this.context.restore()}})}(o),{sceneLayer:2}),o}function F(){this.dt+=1/60,this.dt>=1&&(this.dt=0,console.table(this.sprites.filter(t=>{let e=n.typesToLog.includes(t.type);return n.onlyLogInProximityToShip&&(e=e&&r.areNear(t,this.cameraPosition,50)),e}).map(n.logTheseProperties)))}let N=225,z=10,H=125;function G(t,e,i){return{isEnabled:!0,disable(){this.isEnabled=!1,this.dt=0},onEnergyChanged(s){s>i&&!this.isEnabled?(this.isEnabled=!0,t.showMessage(T(`- ${e.toUpperCase()} ONLINE -`))):s<i&&this.isEnabled&&(this.disable(),t.showMessage(T(`- ${e.toUpperCase()} OFFLINE -`)))}}}let q=100,U=5;function Q(t,e,i,s,n,r,l=10,d={r:255,g:255,b:255}){let c=Math.cos(o(i)),p=Math.sin(o(i));return kontra.sprite({type:"Bullet",x:t.x+12*c,y:t.y+12*p,dx:e.dx+5*c,dy:e.dy+5*p,damage:l,owner:r,ttl:50,width:2,height:2,color:d,update(){this.advance();for(let t=0;t<=2;t++){let t=S({x:this.x,y:this.y},{dx:this.dx,dy:this.dy},s,i,{color:d});n.addSprite(t)}},render(){let t=h(this,s);P.fillRect(this.context,t.x,t.y,this.width,this.height,a.rgb(this.color))}})}let V=10;function Y(t,e){Object.keys(e.properties).forEach(i=>{void 0===t[i]&&(t[i]=e.properties[i])}),t.update=function(t,e){return function(...i){e.apply(this,i),t.apply(this,i)}}(t.update,e.update).bind(t),e.render&&(t.render=L(t.render,e.render).bind(t))}function X(t,e=500){return{type:1,properties:{dtfs:0,speed:2},update(i){this.dtfs+=1/60;let s=R.getDistanceMagnitude(this,t);if(s<e&&this.dtfs>.25){this.activeBehavior=1,this.dtfs=0;let e=R.getDistance(t,this);this.dx=this.maxSpeed*e.x/s,this.dy=this.maxSpeed*e.y/s}else this.dtfs>1&&1===this.activeBehavior&&(this.dtfs=0,this.dx=0,this.dy=0,this.activeBehavior=void 0)}}}function J(t,e){return{type:2,properties:{dts:0,damage:1,color:{r:255,g:255,b:255}},update(i){this.dts+=1/60;let s=R.getDistanceMagnitude(this,e);if(this.dts>.5&&s<300){this.dts=0;let i=Q(this,this,function(t){return 180*t/Math.PI}(Math.atan2(this.dy,this.dx)),e,t,this,this.damage,this.color);t.addSprite(i)}}}}function K(t=0,e=150,i){return{type:3,properties:{patrolOrbit:e,angle:0,dpta:1,dtpt:0,patrolTarget:i},update(e){this.activeBehavior&&3!==this.activeBehavior||this.patrolTarget&&(this.activeBehavior=3,0===t?function(){let t=R.getDistanceMagnitude(this,this.patrolTarget);if(t>this.patrolOrbit){let e=R.getDistance(this.patrolTarget,this);this.dx=this.speed*e.x/t,this.dy=this.speed*e.y/t}else{this.dx=0,this.dy=0,this.angle+=this.dpta;let t=r.inCircleGivenAngle(this.patrolTarget,this.patrolOrbit,this.angle);this.x=t.x,this.y=t.y}}.call(this):function(){let t=R.getDistanceMagnitude(this,this.patrolTarget);if(t>this.patrolOrbit){let e=R.getDistance(this.patrolTarget,this);this.dx=this.speed*e.x/t,this.dy=this.speed*e.y/t,this.dtpt=0}else if(this.dtpt+=1/60,0===this.dx&&0===this.dy||this.dtpt>1){this.dtpt=0;let t=u(0,2*Math.PI);this.dx=this.speed*Math.cos(t),this.dy=this.speed*Math.sin(t)}}.call(this))}}}function Z(){return I({condition(){return this.wasDamaged},action(){this.wasDamaged=!1},t:.25})}function tt(t,e){let i=n.Factions[e],s=function(t,e,i=0){return kontra.sprite({maxEnergy:t,energy:t,systems:[],subscribe(t){this.systems.push(t)},x:5,y:5,update:L($,I({action(){let t=5-this.systems.filter(function(t){return t.isEnabled}).length;this.recharge(t+i)},t:.25})),render(){let t=Math.ceil(100*this.energy/this.maxEnergy);P.fillRect(this.context,this.x,this.y,t,5,"green"),P.strokeRect(this.context,this.x,this.y,100,5,"white")},consume(t){this.energy>0&&(this.energy-=t),this.systems.forEach(t=>t.onEnergyChanged(this.energy))},recharge(t){this.energy<this.maxEnergy&&(this.energy+=t),this.energy>this.maxEnergy&&(this.energy=this.maxEnergy),this.systems.forEach(t=>t.onEnergyChanged(this.energy))},hasEnoughEnergy(t){return this.energy>=t},addOfflineText(t){e.showMessage(T(t))}})}(700,t),r=function(t,e=0){return kontra.sprite({maxLife:t,life:t,x:5,y:15,update:L($,I({action(){this.repair(1+e)},t:1})),repair(t){this.life<this.maxLife&&(this.life+=t),this.life>this.maxLife&&(this.life=this.maxLife)},render(){let t=Math.ceil(this.life*q/this.maxLife);P.fillRect(this.context,this.x,this.y,t,U,"red"),P.strokeRect(this.context,this.x,this.y,q,U,"white")},damage(t){this.life>0&&(this.life-=t),this.life<0&&(this.life=0)},get(){return this.life}})}(300),h=function(t,e,i,s,n,a=0){let r=kontra.sprite(Object.assign({},G(n,"SHIELD",3*e.maxEnergy/6),{maxShield:t,shield:t,x:5,y:25,shieldPosition:i,radius:s,dt:0,dtr:0,dwd:0,wasDamaged:!1,update(){this.dt+=1/60,this.dt>.25&&(this.isEnabled?this.shield<this.maxShield&&(this.shield+=1+a):this.damage(3),this.dt=0),this.wasDamaged&&(this.dwd+=1/60,this.dwd>.25&&(this.wasDamaged=!1,this.dwd=0))},render(){let t=Math.ceil(100*this.shield/this.maxShield);P.fillRect(this.context,this.x,this.y,t,5,"#00edff"),P.strokeRect(this.context,this.x,this.y,100,5,"white"),0!==this.shield&&(this.dtr+=1/60,!this.isEnabled&&this.dtr>.5&&this.dtr<.75||(!this.isEnabled&&this.dtr>.75?this.dtr=0:(this.context.save(),this.context.strokeStyle="#00edff",this.context.fillStyle="rgba(0, 237, 255, 0.2)",this.context.beginPath(),this.context.arc(this.shieldPosition.x+u(-.5,.5),this.shieldPosition.y+u(-.5,.5),1.1*this.radius,0,2*Math.PI),this.context.stroke(),this.context.fill(),this.wasDamaged&&(this.context.globalCompositeOperation="color",this.context.fillStyle="rgba(255,0,0,0.5)",this.context.strokeStyle="rgba(255,0,0,1)",this.context.beginPath(),this.context.arc(this.shieldPosition.x+u(-.5,.5),this.shieldPosition.y+u(-.5,.5),1.1*this.radius,0,2*Math.PI),this.context.stroke(),this.context.fill()),this.context.restore())))},damage(t){this.shield>0&&(this.shield-=t),this.shield<0&&(this.shield=0),this.wasDamaged=!0},get(){return this.shield},disable(){this.isEnabled=!1}}));return e.subscribe(r),r}(400,s,{x:n.canvasWidth/2,y:n.canvasHeight/2},20,t),l=kontra.sprite({x:n.canvasWidth-N,y:n.canvasHeight-z,shipPosition:"",speed:0,updateShipInformation({x:t,y:e,dx:i,dy:s}){this.shipPosition=`(${t.toFixed(0)}, ${e.toFixed(0)})`;let n=R.getMagnitude({x:i,y:s});this.speed=n},render(){let t=`${(100*this.speed).toFixed(0)} zork/s`;P.fillText(this.context,this.shipPosition,this.x,this.y),P.fillText(this.context,t,this.x+H,this.y)}}),d=function(t,e,i=0,s={r:255,g:255,b:255}){let n=kontra.sprite(Object.assign({},G(t,"WEAPONS",2*e.maxEnergy/6),{ship:void 0,dt:0,rotation:0,position:{x:0,y:0},velocity:{dx:0,dy:0},updateShipInformation(t,e,i){this.position=t,this.velocity=e,this.rotation=i},update(){if(this.isEnabled&&(this.dt+=1/60,kontra.keys.pressed("space")&&this.dt>.25+i&&e.hasEnoughEnergy(V))){this.dt=0,e.consume(V);let i=Q(this.position,this.velocity,this.rotation,t.cameraPosition,t,this.ship,10,s);t.addSprite(i)}}}));return e.subscribe(n),n}(t,s,0,i.Color),c=function(t,e){let i=kontra.sprite(Object.assign({},G(t,"NEAR SPACE RADAR",1*e.maxEnergy/6),{dt:0,render(){if(!this.isEnabled){this.context.save(),this.context.translate(n.canvasWidth/2,n.canvasHeight/2),this.context.beginPath();let t=this.context.createRadialGradient(0,0,Math.min(n.canvasWidth,n.canvasHeight)/8,0,0,3*Math.max(n.canvasWidth,n.canvasHeight)/4);t.addColorStop(0,"rgba(0,0,0,0.2)"),t.addColorStop(1,"rgba(0,0,0,1)"),this.context.fillStyle=t,this.context.arc(0,0,Math.max(n.canvasWidth,n.canvasHeight),0,2*Math.PI),this.context.fill(),this.context.restore()}}}));return e.subscribe(i),i}(t,s),p=kontra.sprite({type:"Ship",faction:e,parts:[s,r,h,l,d,c],image:n.Factions[e].Ship,x:5600,y:5600,rotation:0,collisionWidth:20,energy:s,life:r,shield:h,speed:l,weapons:d,vision:c,dt:0,ttl:1/0,wasDamaged:!1,takeDamage(t){this.shield.get()>0?(this.shield.damage(t),this.shield.get()<=0&&(this.life.damage(t/4),this.wasDamaged=!0)):(this.life.damage(t),this.wasDamaged=!0),this.life.get()<=0&&(this.ttl=0)},render(){this.context.save(),this.context.translate(n.canvasWidth/2,n.canvasHeight/2),this.context.rotate(o(this.rotation)),this.context.drawImage(this.image,-16,-16),this.wasDamaged&&(this.context.globalCompositeOperation="source-atop",this.context.fillStyle="rgba(255,0,0,0.5)",this.context.fillRect(-16,-16,32,32)),this.context.restore(),this.parts.forEach(t=>t.render())},update:L(function(){if(this.weapons.updateShipInformation(this,this,this.rotation),this.speed.updateShipInformation(this),this.parts.forEach(t=>t.update()),kontra.keys.pressed("left")){this.rotation-=3;let e=this.createShipParticle(p.rotation+75,{x:5,y:-10});t.addSprite(e)}else if(kontra.keys.pressed("right")){this.rotation+=3;let e=this.createShipParticle(p.rotation-75,{x:5,y:10});t.addSprite(e)}const e=Math.cos(o(this.rotation)),i=Math.sin(o(this.rotation));if(kontra.keys.pressed("up")&&this.energy.hasEnoughEnergy(1)){this.ddx=.1*e,this.ddy=.1*i,this.energy.consume(1);for(let e=0;e<2;e++){let e=this.createShipParticle(p.rotation+180,{x:20,y:0});t.addSprite(e)}}else if(kontra.keys.pressed("down")&&this.energy.hasEnoughEnergy(1)){this.ddx=-.1*e/2,this.ddy=-.1*i/2,this.energy.consume(1);let s=this.createShipParticle(p.rotation+75,{x:5,y:-10}),n=this.createShipParticle(p.rotation-75,{x:5,y:10});t.addSprite(s),t.addSprite(n)}else this.ddx=this.ddy=0;this.advance(),Math.sqrt(this.dx*this.dx+this.dy*this.dy)>10&&(this.dx*=.95,this.dy*=.95)},Z()),createShipParticle:(t,e={x:0,y:0})=>(function(t,e,i,s={x:4,y:0}){let n=u(.5,1.5),r=u(.5,1.5),h=u(-20,20),l=Math.cos(o(i+h)),d=Math.sin(o(i+h));return kontra.sprite({type:"Particle",x:t.x,y:t.y,dx:e.dx*l*n,dy:e.dy*d*r,ttl:u(10,70),dt:0,width:2,thicknessVariance:u(-4,4),update(){this.dt+=1/60,this.advance()},render(){let t=60*this.dt,e=1-t/70,n=(1+.5*t/70)*this.width;this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(o(i)),this.context.fillStyle=a.rgba(255,255,255,e),this.context.fillRect(s.x,s.y+this.thicknessVariance,n,n),this.context.restore()}})})({x:n.canvasWidth/2,y:n.canvasHeight/2},{dx:1,dy:1},t,e)});return d.ship=p,p}function et(){let t=y(2,4),e="";for(let i=0;i<t;i++)e+=`${at()}`;return e}let it=["a","e","i","o","u","ä","ö","å"],st=97,nt=122;function at(){let t=y(1,3);return 1===t?rt():2===t?`${ot()}${rt()}`:`${ot()}${rt()}${ot()}`}function rt(){return g(it)}function ot(){let t="";for(;!t;){let e=y(st,nt),i=String.fromCharCode(e);it.includes(i)||(t=i)}return t}function ht(t,e,i,s,l,{drawOuterRadius:d=!0,type:p=g(lt.filter(t=>7!==t)),name:y=et(),startingAngle:x=u(0,360),claimedBy:f}={}){let m=p,b=r.inCircleGivenAngle(t,e,x),v=u(0,.05);return kontra.sprite({type:"Planet",planetType:m,name:y,origin:t,orbit:e,x:b.x,y:b.y,radius:i,outerRadius:i+.25*i,ttl:1/0,angle:x,da:v,rotation:u(0,Math.PI),claimedBy:f,beingClaimed:!1,claimedPercentage:0,isClaimed(){return void 0!==this.claimedBy},increaseClaim(t,e){let i=n.Factions[t].Name;this.beingClaimed||(l.showMessage(T(`${i} FACTION CLAIMING ${y}`)),this.beingClaimed=!0),this.claimedPercentage+=e,this.claimedPercentage>=100&&(this.claimedPercentage=100,this.beingClaimed=!1,this.claimedBy=t,l.showMessage(T(`${i} FACTION CLAIMED ${y}`)))},isChangingPlanetType:!1,dcpt:0,count:13,oldPlanetType:m,newPlanetType:void 0,changePlanetTo(t){this.newPlanetType=t,this.isChangingPlanetType=!0},beingCollected:!1,resources:3e3,update(){this.rotation+=.25,this.angle+=this.da;let t=r.inCircleGivenAngle(this.origin,e,this.angle);this.x=t.x,this.y=t.y,this.isChangingPlanetType&&(this.dcpt+=1/60,this.dcpt>.05*this.count&&(this.dcpt=0,this.count--,this.planetType===this.oldPlanetType?this.planetType=this.newPlanetType:this.planetType=this.oldPlanetType,0===this.count&&(this.isChangingPlanetType=!1)))},render(){if(c(this,s))return;let t=h(this,s);this.context.save();let e=h(this.origin,s);this.context.translate(e.x,e.y),P.drawCircle(this.context,0,0,this.orbit,"rgba(255,255,255,0.15"),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),P.fillCircle(this.context,0,0,this.radius,ct(100,100,this.planetType)),this.context.beginPath();let r=this.context.createRadialGradient(0,0,3*this.radius/4,0,0,this.radius);r.addColorStop(0,"rgba(0,0,0,0)"),r.addColorStop(1,"rgba(0,0,0,0.7)"),P.fillCircle(this.context,0,0,this.radius,r),d&&P.drawCircle(this.context,0,0,this.outerRadius,"turquoise",1,[3,7]),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y-i-45);let l=this.name.length/2*10;if(P.fillText(this.context,this.name.toUpperCase(),-l,0),this.context.restore(),this.beingClaimed){let e=2*i,s=this.claimedPercentage/100*e;this.context.save(),this.context.translate(t.x-i,t.y+i+35),P.fillRect(this.context,0,0,s,5,"white"),P.strokeRect(this.context,0,0,e,5,"white"),this.context.restore()}if(void 0!==this.claimedBy){let e=i+.35*i;this.context.save(),this.context.translate(t.x,t.y);let s=n.Factions[this.claimedBy].Color;P.drawCircle(this.context,0,0,e,a.rgb(s),5),this.context.restore()}}})}let lt=[0,1,2,3,4,5,6,7],dt=[{h:16,s:100,l:66},{h:0,s:70,l:45},{h:120,s:100,l:39},{h:195,s:100,l:50},{h:48,s:100,l:76},{h:28,s:87,l:67},{h:0,s:0,l:83},{h:199,s:98,l:48},{h:60,s:100,l:50}];function ct(t,e,i){let s=dt[i];return 7===i?function(t,e,i){return x.instance().getPatternBasedOnColors(i,{h:120,s:61,l:34},t,e,3)}(t,e,s):x.instance().getPatternBasedOnColors(s,{h:s.h,s:s.s,l:s.l-10},t,e,3)}let pt=1e4;function ut(t,e,i,s=et()){let n="sun"===s,a="orion"===s,r=function(t,e,i){let s={x:t.x+pt/2,y:t.y+pt/2},n=u(125,175);return function(t,e,i,s=et()){return kontra.sprite({type:"Sun",x:t.x,y:t.y,radius:e,damageOuterRadius:e+.25*e,energyOuterRadius:3*e,ttl:1/0,dt:0,rotation:0,update(){this.rotation+=.1},render(){if(c(this,i))return;let t=h(this,i);this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),P.fillCircle(this.context,0,0,this.radius,ct(100,100,8));let n=this.context.createRadialGradient(0,0,3*this.radius/4,0,0,this.radius);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,0.7)"),P.fillCircle(this.context,0,0,this.radius,n),P.drawCircle(this.context,0,0,this.damageOuterRadius,"red",1,[2,2]),P.drawCircle(this.context,0,0,this.energyOuterRadius,"yellow",1,[3,7]),this.context.restore(),this.context.save(),this.context.translate(t.x,t.y-e-45);let a=s.length/2*10;P.fillText(this.context,s.toUpperCase(),-a,0),this.context.restore()}})}(Object.assign({},s),n,e,i)}(e,i,s),l=function(t,e,i,{isSunSystem:s=!1,isOrion:n=!1}){if(s)return function(t,e,i){return[{orbit:300,radius:30,name:"mercury",type:6},{orbit:500,radius:70,name:"venus",type:4},{orbit:700,radius:50,name:"*earth*",type:7,angle:40,claimedBy:1},{orbit:900,radius:40,name:"mars",type:0},{orbit:1500,radius:150,name:"jupiter",type:5},{orbit:2100,radius:130,name:"saturn",type:5},{orbit:2700,radius:110,name:"uranus",type:3},{orbit:3500,radius:110,name:"neptune",type:3}].map(s=>ht(t,s.orbit,s.radius,i,e,{name:s.name,type:s.type,startingAngle:s.angle,claimedBy:s.claimedBy}))}(t,e,i);if(n)return function(t,e,i){return[ht(t,700,100,i,e,{name:"orion",type:7})]}(t,e,i);let a=y(1,5),r=[],o={x:t.x,y:t.y};for(let s=0;s<a;s++){let s=u(500,1e3);o.x=o.x+s;let n=u(50,100),a=ht(t,o.x-t.x,n,i,e);r.push(a)}return r}(r,t,i,{isSunSystem:n,isOrion:a});return{x:e.x,y:e.y,name:s,sun:r,planets:l,bodies:[r,...l]}}function yt({x:t,y:e,cameraPosition:i}){let s=u(0,1).toFixed(2),n=1-3*parseFloat(s)/4,r=a.get(n),o=1-parseFloat(s)+2.5;return kontra.sprite({x:p(t,t/2),y:p(e,e/2),type:"Star",dx:0,dy:0,ttl:1/0,distance:s,color:r,size:o,update(){},render(){let t=h(this,i,this.distance);this.context.fillStyle=this.color,this.context.fillRect(t.x,t.y,this.size,this.size)}})}function gt(t){let e=5600-n.canvasWidth/2-500,i=5600+n.canvasWidth/2+500,s=n.canvasWidth/2+500,a=n.canvasWidth+1e3,r=function({start:t,end:e,spaceBetweenStars:i,cameraPosition:s}){let n=[];for(var a=t;a<=e;a+=i)for(var r=t;r<=e;r+=i){let t=yt({x:a,y:r,cameraPosition:s});n.push(t)}return n}({start:e,end:i,spaceBetweenStars:75,cameraPosition:t});return kontra.sprite({type:"Background",x:e,y:e,stars:r,dt:0,ttl:1/0,update(){if(this.dt+=1/60,this.dt>.25){this.stars.filter(e=>t.x-e.x>s).forEach(t=>t.x=t.x+a),this.stars.filter(e=>Math.abs(t.x-e.x)>s).forEach(t=>t.x=t.x-a),this.stars.filter(e=>t.y-e.y>s).forEach(t=>t.y=t.y+a),this.stars.filter(e=>Math.abs(t.y-e.y)>s).forEach(t=>t.y=t.y-a)}},render(){this.stars.forEach(t=>t.render())}})}function xt(t,e){let i=g([{h:295,s:100,l:50,r:243,g:0,b:255},{h:120,s:100,l:50,r:0,g:255,b:0}]);return kontra.pool({create(){let s=kontra.sprite({type:"Elder",ship:e,life:100,width:20,color:i,pattern:function(t){return x.instance().getPatternBasedOnColors({h:0,s:0,l:50},t,n.Textures.Elder,n.Textures.Elder)}(i),rotation:45,wasDamaged:!1,activeBehavior:void 0,update:L(function(){this.advance(),this.rotation+=.5},Z()),takeDamage(t){this.life-=t,this.life<0&&(this.ttl=0),this.wasDamaged=!0},render(){if(d(this,this.ship))return;let t=h(this,this.ship);this.renderElder(t),n.debug&&n.showPath&&(this.context.save(),P.drawLine(this.context,t.x,t.y,t.x+20*this.dx,t.y+20*this.dy,"red"),this.context.restore()),n.debug&&n.renderCollisionArea&&(this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),P.drawCircle(this.context,0,0,this.width/2,"red"),this.context.restore())},init(e){let i=e.elderType;Object.assign(this,ft[i]),Object.assign(this,e),1===this.elderType&&(Y(s,K(0,200)),Y(s,X(this.ship,300)),Y(s,J(t,this.ship))),0===this.elderType?(Y(s,K(1)),Y(s,X(this.ship,400)),Y(s,J(t,this.ship))):(Y(s,X(this.ship,300)),Y(s,J(t,this.ship)))}});return s},maxSize:n.Elders.MaxNumber})}let ft={0:{width:10,speed:2,maxSpeed:4,acceleration:.1,life:50,damage:10,renderElder(t){this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),this.context.strokeStyle=this.pattern,this.context.lineWidth=3,this.context.strokeRect(-this.width/2,-this.width/2,this.width,this.width),this.wasDamaged&&(this.context.globalCompositeOperation="source-atop",this.context.fillStyle="rgba(255,0,0,0.5)",this.context.fillRect(-this.width/2,-this.width/2,this.width,this.width)),this.context.restore()}},1:{width:20,speed:2,maxSpeed:2,acceleration:0,life:100,damage:30,renderElder(t){this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),this.context.fillStyle=this.pattern,this.context.fillRect(-this.width/2,-this.width/2,this.width,this.width),this.wasDamaged&&(this.context.globalCompositeOperation="source-atop",this.context.fillStyle="rgba(255,0,0,0.5)",this.context.fillRect(-this.width/2,-this.width/2,this.width,this.width)),this.context.restore()}},2:{width:100,speed:.5,maxSpeed:1,acceleration:0,life:500,damage:100,renderElder(t){this.context.save(),this.context.translate(t.x,t.y),this.context.rotate(o(this.rotation)),this.context.fillStyle=this.pattern,this.context.fillRect(-this.width/4,-this.width/4,this.width/2,this.width/2),this.context.rotate(o(this.rotation+1.5)),P.drawCircle(this.context,0,0,this.width/2,this.pattern,5),this.wasDamaged&&(this.context.globalCompositeOperation="source-atop",this.context.fillStyle="rgba(255,0,0,0.5)",this.context.fillRect(-this.width/2-10,-this.width/2-10,this.width+20,this.width+20)),this.context.restore()}}},mt={grey:{h:0,s:0,l:50},granate:{h:295,s:100,l:50,r:243,g:0,b:255},green:{h:120,s:100,l:50,r:0,g:255,b:0}};function bt(t,e,i){let s=60*i;return kontra.sprite({seconds:s,x:t,y:e,ttl:1/0,isStarted:!1,start(){this.isStarted=!0},update:L($,I({condition(){return this.isStarted},action(){this.seconds--},t:1})),render(){let i=`${Math.floor(this.seconds/60)}:${(this.seconds%60).toString().padStart(2,"0")}`;this.context.fillStyle="white",this.context.font="normal normal 24px monospace",this.context.fillText(i,t,e)}})}function vt(t){let e=jt.instance(),i=j(),s=_({camera:i,props:{shipDestroyedEndingPlayed:!1,counterNearEndingPlayed:!1,counterEndingPlayed:!1,checkCounterNearEnding(){h.seconds<=0&&!this.counterNearEndingPlayed&&(this.counterNearEndingPlayed=!0,e.story.play(s,2))},checkCounterIsFinished(){if(h.seconds<=0&&!this.counterEndingPlayed){this.counterEndingPlayed=!0;let t=e.story.play(s,1);this.goToGameOver(t)}},checkShipIsAlive(){if(!a.isAlive()&&!this.shipDestroyedEndingPlayed){this.shipDestroyedEndingPlayed=!0;let t=e.story.play(s,3);this.goToGameOver(t)}},goToGameOver(t){setTimeout(()=>{e.goToGameOverScene()},1e3*t)}},update(){this.checkCounterNearEnding(),this.checkCounterIsFinished(),this.checkShipIsAlive()}}),a=tt(s,t.faction);i.position=a;let r=xt(s,a);s.addPool(r),function(t,e){let i=gt(e);t.addSprite(i,{sceneLayer:0})}(s,a),function(t,e,i){let{paradiseSectorX:s,paradiseSectorY:n}=function(){let t=0,e=0;for(;0==t&&0==e;)t=1e4*y(-5,4),e=1e4*y(-5,4);return{paradiseSectorX:t,paradiseSectorY:e}}();for(let a=-5e4;a<5e4;a+=1e4)for(let r=-5e4;r<5e4;r+=1e4){let o=Pt(t,e,{x:a,y:r},{x:s,y:n});if(o.bodies.forEach(e=>t.addSprite(e)),St(t,e,a,r,!0),0===a&&0===r&&St(t,e,a,r),a===s&&r===n)Tt(i,{x:s+5e3,y:n+5e3});else if(0!==a&&0!==r){let t=g(o.planets);Et(i,{x:a+5e3,y:r+5e3},t)}}}(s,a,r),s.addSprite(a),e.gameData.earth.changePlanetTo(1);let o=e.story.play(s,0),h=bt(10,n.canvasHeight-10,15);return setTimeout(()=>{s.addSprite(h,{sceneLayer:2}),h.start()},1e3*o),s}function St(t,e,i,s,n=!1){for(let a=0;a<20;a++){wt(t,e,Math.ceil(u(0,7)),n,100,i,s)}}function wt(t,e,i,s=!1,n=100,a=0,r=0){let o=a+u(-1e4,1e4),h=r+u(-1e4,1e4),l=0,d=0;s||(l=u(-2,2),d=u(-2,2));for(var c=0;c<i;c++){let i=u(0,30),a=u(-n,n),r=u(-n,n),c=0;s||(c=u(-.25,.25));let p=v({x:o+a,y:h+r},{dx:l+c,dy:d+c},i,e);t.addSprite(p)}}function Pt(t,e,i,s){let n;return 0===i.x&&0===i.y?(n=ut(t,i,e,"sun"),jt.instance().gameData.earth=n.planets.find(t=>"*earth*"===t.name)):i.x===s.x&&i.y===s.y?(n=ut(t,i,e,"orion"),jt.instance().gameData.orion=n.planets.find(t=>"orion"===t.name)):n=ut(t,i,e),n}function Et(t,e,i){let s=y(1,6);for(let n=0;n<=20*s;n+=20)t.get({x:e.x+200+n,y:e.y+200+n,ttl:1/0,dx:0,dy:0,elderType:0,patrolTarget:i,patrolOrbit:100+n,angle:n})}function Tt(t,e){t.get({x:e.x+300,y:e.y+300,ttl:1/0,dx:0,dy:0,elderType:2,patrolTarget:jt.instance().gameData.orion});for(let i=0;i<=60;i+=20)t.get({x:e.x+200+i,y:e.y+200+i,ttl:1/0,dx:0,dy:0,elderType:1,patrolTarget:t.getAliveObjects().filter(t=>2===t.elderType)[0],patrolOrbit:100+i,angle:i});for(let i=0;i<1e3;i+=100)t.get({x:e.x+i,y:e.y+i,ttl:1/0,dx:0,dy:0,elderType:0,patrolTarget:t.getAliveObjects().filter(t=>2===t.elderType)[0]})}function kt(){let t=_({update:function(){kontra.keys.pressed("enter")&&jt.instance().goToSpaceScene()}}),e=C("Earth-That-Was",{x:void 0,y:250},{},{size:48});t.addSprite(e);let i=C("Press ENTER to start",{x:void 0,y:300});return t.addSprite(i),t}function Ct(t,e=0){let i=t.createOscillator();return i.frequency.value=e,i}function Mt(t,e){let i=t.createGain();return i.gain.value=e,i}function Rt(t,e,i,s){let n=Ct(t,e),a=Ct(t,i),r=Mt(t,s);return n.connect(r),a.connect(r),{connect(t){r.connect(t)},start(t=0){n.start(t),a.start(t)},stop(t=0){n.stop(t),a.stop(t)}}}function Ot(t){let e=Rt(t,330,330.2,.5),i=Rt(t,440,440.33,.5),s=Rt(t,587,587.25,.5),n=Mt(t,.1);return function({to:t},...e){e.forEach(e=>e.connect(t))}({to:n},e,i,s),n.connect(t.destination),{start(){e.start(),i.start(),s.start()},stop(){e.stop(),i.stop(),s.stop()}}}const At={0:Ot,1:Ot};let Bt=[T("And thus the once bright light of humankind...",2),T("disappeared from the face of the cosmos...",2)];const Dt={0:[T("Hmm...."),T("Err..."),T("Fuck."),T("I was kinda hoping it wouldn't get to that"),T("- INCOMING TRANSMISSION -",1),T("This is a recorded message.",1),T("I'm the president of Earth",1),T("Earth has been destroyed.",1),T("HAL 9000, You're mankind's last hope",1),T("Find a new earth",1),T("*fast*",1),T("Farewell and good luck",1),T("Find a New Earth. Fast",2)],3:[T("OOoops, that had to hurt",2),...Bt],2:[T("Humans aren't very durable creatures",2),T("As time passes the cryogenic devices start to fail",2),T("and first dozens, then hundreds, the thousands peril...",2)],1:[...Bt,T("You had one job.",2)],4:[T("A new world!",2),T("Now we can start anew and build a better world",2),T("Will we?",2),T("(Evil chipmunk)",2)]};class jt{constructor(){this.assets=function(){let t={};return{images:t,load(...e){e.forEach(e=>{let i=new Image;i.src=e,i.onload=function(){t[function(t){return t.split(".")[0].toLowerCase()}(e)]=t[e]=this}})}}}(),this.story={play(t,e){let i=Dt[e];return t.showMessage(...i),2*i.length}},this.gameMusic=function(){let t=new AudioContext;return{currentTrack:void 0,play(e){this.currentTrack&&this.currentTrack.stop();let i=At[e];this.currentTrack=i(t),this.currentTrack.start()},stop(){this.currentTrack.stop()}}}(),this.gameMusic.play(0),this.currentScene=kt(),this.preloadTextures()}static instance(){return void 0==this.game&&(this.game=new jt),this.game}start(){this.currentScene.start()}goToSpaceScene(t=1){this.gameData=function(t){return{faction:t,earth:void 0,orion:void 0}}(t),this.switchToScene(vt(this.gameData)),this.gameMusic.play(1)}goToGameOverScene({win:t=!1}={}){this.switchToScene(function({win:t=!1}={}){let e=_({update:function(){kontra.keys.pressed("enter")&&jt.instance().goToOpenScene()}}),i=C(t?"VICTORY!!!!":"GAME OVER",{x:void 0,y:250},void 0,{size:48});e.addSprite(i);let s=C("Press ENTER to play again",{x:void 0,y:300});return e.addSprite(s),e}({win:t})),this.gameData=null}goToOpenScene(){this.switchToScene(kt())}switchToScene(t){this.gameMusic.stop(),this.currentScene.stop(),this.currentScene=t,this.start()}preloadTextures(){lt.forEach(t=>this.preloadPlanetTexture(t,100)),this.preloadPlanetTexture(8,100),this.preloadElderTexture(mt.granate),this.preloadElderTexture(mt.green);let t={h:37,s:55,l:57};x.instance().getPatternBasedOnColors(t,{h:t.h,s:t.s,l:t.l+10})}preloadPlanetTexture(t,e){let i=dt[t];x.instance().getPatternBasedOnColors(i,{h:i.h,s:i.s,l:i.l+10},e,e,3)}preloadElderTexture(t){x.instance().getPatternBasedOnColors(mt.grey,t,20,20)}}var $t=i(0),Lt=i.n($t);let It=window.document.querySelector("canvas");It.width=window.innerWidth,It.height=window.innerHeight,kontra.init(),kontra.context.scale(n.scale,n.scale);let Wt=jt.instance();Wt.assets.load(Lt.a),Wt.start()}]);